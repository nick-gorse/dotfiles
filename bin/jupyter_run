#!/usr/local/bin/zsh
function jupyter_start() {
	nohup jupyter lab --no-browser --port ${JUP_PORT:-9888} -y > $HOME/jup.log 2>&1 &
	export JUP_PID=$!
}

function jupyter_kill() {
	jupyter server stop ${JUP_PORT:-9888} >> $HOME/jup.log 2>&1
	unset JUP_PID
}

function jupyter_help() {
	printf "Usage: jupyter_run [-h, --help] [-s, --show] [-r, --restart]\n"; return 0 2>/dev/null
}

function jupyter_run() {
    if ! jupyter server list --json | grep ${JUP_PORT:-9888} > /dev/null 2>&1; then
        jupyter_start
	else
	    while [[ "$1" =~ ^- && ! "$1" == "--" ]]
		do
			case $1 in
				(-r | --restart ) jupyter_kill
						jupyter_start                   ;;
				(-s | --show )	jupyter server list | grep ${JUP_PORT:-9888}     ;;
				(-h | --help )	jupyter_help      ;;
		    	(*) return 1 2>/dev/null                   ;;
			esac
			shift
		done
	    if [[ "$1" == '--' ]]; then shift; fi
		return 02>/dev/null
    fi
}

jupyter_run